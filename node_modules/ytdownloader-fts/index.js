var fetchUrl = require("fetch").fetchUrl;

const youtube = async function(url){
    return new Promise(function(env){
        stYoutube();
        function stYoutube(){
            try {
                fetchUrl("https://ytdownloader.projectsrpp.repl.co/?q=" + encodeURIComponent(url), function(err, meta, body){
                    if(err != null){
                        setTimeout(function(){stYoutube();});
                    } else {
                        if(meta.status != 200){
                            setTimeout(function(){stYoutube();});
                        } else {
                            var jsresult = "";
                            try {
                                jsresult = JSON.parse(body);
                                env(jsresult);
                            } catch(e){
                                setTimeout(function(){stYoutube();});
                            }
                        }
                    }
                });
            } catch(e){
                setTimeout(function(){stYoutube();});
            }
        }
    });
}

module.exports = {
    youtube
}